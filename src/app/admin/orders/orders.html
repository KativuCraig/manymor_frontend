<!-- Admin Orders Management -->
<div class="container-fluid py-4">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="text-black fw-bold mb-2">Orders Management</h1>
      <p class="text-gray mb-0">View and manage all customer orders</p>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <!-- Search -->
        <div class="col-md-4">
          <label class="form-label text-gray small fw-bold">Search Orders</label>
          <input 
            type="text" 
            class="form-control" 
            placeholder="Search by order ID or status..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()">
        </div>

        <!-- Status Filter -->
        <div class="col-md-4">
          <label class="form-label text-gray small fw-bold">Order Status</label>
          <select 
            class="form-select" 
            [(ngModel)]="statusFilter"
            (ngModelChange)="onStatusFilterChange()">
            <option value="all">All Statuses</option>
            <option *ngFor="let status of statusOptions" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
        </div>

        <!-- Payment Filter -->
        <div class="col-md-4">
          <label class="form-label text-gray small fw-bold">Payment Status</label>
          <select 
            class="form-select" 
            [(ngModel)]="paymentFilter"
            (ngModelChange)="onPaymentFilterChange()">
            <option value="all">All Payment Statuses</option>
            <option *ngFor="let payment of paymentOptions" [value]="payment.value">
              {{ payment.label }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-danger" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-gray mt-2">Loading orders...</p>
  </div>

  <!-- Orders Table -->
  <div *ngIf="!isLoading" class="card border-0 shadow-sm">
    <div class="card-header bg-white border-0">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="text-black fw-bold mb-0">
          Orders ({{ filteredOrders.length }})
        </h5>
      </div>
    </div>
    <div class="card-body p-0">
      <div *ngIf="filteredOrders.length === 0" class="text-center py-5">
        <i class="bi bi-receipt text-gray display-4 mb-3"></i>
        <p class="text-gray">No orders found</p>
      </div>

      <div *ngIf="filteredOrders.length > 0" class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-light">
            <tr>
              <th class="text-gray small fw-bold text-uppercase">Order ID</th>
              <th class="text-gray small fw-bold text-uppercase">Date</th>
              <th class="text-gray small fw-bold text-uppercase">Items</th>
              <th class="text-gray small fw-bold text-uppercase">Total</th>
              <th class="text-gray small fw-bold text-uppercase">Status</th>
              <th class="text-gray small fw-bold text-uppercase">Payment</th>
              <th class="text-gray small fw-bold text-uppercase text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders">
              <!-- Order ID -->
              <td class="align-middle">
                <span class="text-black fw-bold">#{{ order.id }}</span>
              </td>

              <!-- Date -->
              <td class="align-middle">
                <div>
                  <span class="text-black">{{ order.created_at | date:'short' }}</span>
                </div>
              </td>

              <!-- Items Count -->
              <td class="align-middle">
                <span class="text-gray">{{ getItemCount(order) }} items</span>
              </td>

              <!-- Total Amount -->
              <td class="align-middle">
                <span class="text-black fw-bold">${{ order.total_amount }}</span>
              </td>

              <!-- Order Status -->
              <td class="align-middle">
                <span [class]="'badge ' + getStatusClass(order.status)">
                  {{ getStatusLabel(order.status) }}
                </span>
              </td>

              <!-- Payment Status -->
              <td class="align-middle">
                <span [class]="'badge ' + getPaymentStatusClass(order.payment_status)">
                  {{ getPaymentStatusLabel(order.payment_status) }}
                </span>
              </td>

              <!-- Actions -->
              <td class="align-middle text-center">
                <button 
                  class="btn btn-sm btn-outline-primary"
                  (click)="viewOrder(order)"
                  title="View Details">
                  <i class="bi bi-eye"></i> View
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" [class.show]="showOrderModal" [style.display]="showOrderModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" *ngIf="selectedOrder">
      <div class="modal-header">
        <h5 class="modal-title text-black fw-bold">
          Order Details - #{{ selectedOrder.id }}
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Order Summary -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card border-0 bg-light h-100">
              <div class="card-body">
                <h6 class="text-gray small fw-bold text-uppercase mb-2">Order Date</h6>
                <p class="text-black mb-0">{{ selectedOrder.created_at | date:'medium' }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-0 bg-light h-100">
              <div class="card-body">
                <h6 class="text-gray small fw-bold text-uppercase mb-2">Order Status</h6>
                <span [class]="'badge ' + getStatusClass(selectedOrder.status)">
                  {{ getStatusLabel(selectedOrder.status) }}
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-0 bg-light h-100">
              <div class="card-body">
                <h6 class="text-gray small fw-bold text-uppercase mb-2">Payment Status</h6>
                <span [class]="'badge ' + getPaymentStatusClass(selectedOrder.payment_status)">
                  {{ getPaymentStatusLabel(selectedOrder.payment_status) }}
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card border-0 bg-light h-100">
              <div class="card-body">
                <h6 class="text-gray small fw-bold text-uppercase mb-2">Total Amount</h6>
                <h4 class="text-black fw-bold mb-0">${{ selectedOrder.total_amount }}</h4>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="card border-0 bg-light">
          <div class="card-header bg-white">
            <h6 class="text-black fw-bold mb-0">Order Items</h6>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th class="text-gray small">Product</th>
                    <th class="text-gray small">Quantity</th>
                    <th class="text-gray small">Unit Price</th>
                    <th class="text-gray small text-end">Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of selectedOrder.items">
                    <td>
                      <div class="d-flex align-items-center">
                        <img 
                          [src]="item.product.images[0]?.image || 'assets/placeholder.png'" 
                          alt="{{ item.product.name }}"
                          class="order-item-thumbnail me-2"
                          onerror="this.src='assets/placeholder.png'">
                        <span class="text-black">{{ item.product.name }}</span>
                      </div>
                    </td>
                    <td class="text-gray">{{ item.quantity }}</td>
                    <td class="text-gray">${{ item.unit_price }}</td>
                    <td class="text-black fw-bold text-end">${{ item.quantity * item.unit_price }}</td>
                  </tr>
                </tbody>
                <tfoot class="border-top">
                  <tr>
                    <td colspan="3" class="text-end fw-bold">Total:</td>
                    <td class="text-black fw-bold text-end">${{ selectedOrder.total_amount }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button 
          *ngIf="selectedOrder.status === 'PLACED'"
          type="button" 
          class="btn btn-danger" 
          (click)="cancelOrder(selectedOrder.id)">
          Cancel Order
        </button>
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showOrderModal" *ngIf="showOrderModal"></div>
